%%% 1. Packages

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{bm}               % Bold math
\usepackage{booktabs}         % Nice tables
\usepackage{cancel}           % Cancel out math terms
\usepackage{color}            % Color
\usepackage{float}            % Force figure placement with H option
\usepackage[bottom]{footmisc} % Footnote at page bottom
\usepackage{graphicx}         % Graphics support
\usepackage{hyperref}         % Link support
\usepackage{cleveref}         % Better cross-references, must be loaded after hyperref
\usepackage{listings}         % Syntax-highlighted code
\usepackage{mathrsfs}         % Script math
\usepackage{natbib}           % Bibliography support
\usepackage{subcaption}       % Subfigures and subtables


%%% 2. Math Typesetting

% Label individual equations in align* or gather*
% Example (only first equation is labeled):
%   \begin{align*}
%     f(x) &= ax^2 + bx + c \tageq \label{eq:f} \\
%     g(x) &= \log x \\
%     h(x) &= f(x) + g(x)
%   \end{align*}
%   As we see in equation~\eqref{eq:f}...
\newcommand*{\tageq}{\refstepcounter{equation}\tag{\theequation}}

% Switch \epsilon and \varepsilon
\let\oldepsilon\epsilon
\let\oldvarepsilon\varepsilon
\renewcommand{\epsilon}{\oldvarepsilon}
\renewcommand{\varepsilon}{\oldepsilon}

% Add space before \forall
\let\oldforall\forall
\renewcommand{\forall}{\ \oldforall}

% Wide versions of accents
\renewcommand{\bar}[1]{\overline{#1}}
\renewcommand{\hat}[1]{\widehat{#1}}
\renewcommand{\tilde}[1]{\widetilde{#1}}

% Left and right brackets
\newcommand{\group}[1]{\left. #1 \right.}
\newcommand{\paren}[1]{\left( #1 \right)}
\newcommand{\bracket}[1]{\left[ #1 \right]}
\newcommand{\curly}[1]{\left\{ #1 \right\}}
\newcommand{\inner}[1]{\left\langle #1 \right\rangle}  % Inner product
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}  % Floor
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}     % Ceiling
\newcommand{\abs}[1]{\left| #1 \right|}                % Absolute value
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}     % Norm
\newcommand{\eval}[1]{\left. #1 \right|}               % Evaluated at

% General math
\newcommand{\oh}{\frac{1}{2}}
\newcommand{\st}{\text{ s.t. }}                        % Such that
\newcommand{\where}{\middle|}                          % Where
\newcommand{\comp}[1]{#1^{\mathsf{c}}}                 % Complement
\newcommand{\inv}[1]{#1^{-1}}                          % Inverse
\renewcommand{\d}{\ \text{d}}                          % Differential
\newcommand{\corrto}{\rightrightarrows}                % Correspondence
\newcommand{\N}{\mathbb{N}}                            % Natural numbers
\newcommand{\Z}{\mathbb{Z}}                            % Integers
\newcommand{\Q}{\mathbb{Q}}                            % Rational numbers
\newcommand{\R}{\mathbb{R}}                            % Real numbers
\newcommand{\C}{\mathbb{C}}                            % Complex numbers
\renewcommand{\L}{\mathcal{L}}                         % Lagrangian for optimization problem
\newcommand{\sumin}{\sum_{i=1}^n}                      % Sum from 1 to n
\newcommand{\prodin}{\prod_{i=1}^n}                    % Product from 1 to n
\newcommand{\join}{\vee}                               % Join
\newcommand{\bigjoin}{\bigvee}                         %
\newcommand{\meet}{\wedge}                             % Meet
\newcommand{\bigmeet}{\bigwedge}                       %
\DeclareMathOperator*{\argmax}{arg\,max}               % Argmax
\DeclareMathOperator*{\argmin}{arg\,min}               % Argmin

% Derivatives
\newcommand{\der}[2]{\frac{\d #1}{\d #2}}              % Derivative
\newcommand{\derol}[2]{\d #1/\d #2}                    % Derivative (one line)
\newcommand{\sder}[2]{\frac{\d^2 #1}{\d #2^2}}         % Second derivative
\newcommand{\pder}[2]{\frac{\partial #1}{\partial #2}} % Partial derivative
\newcommand{\pderol}[2]{\partial #1/\partial #2}       % Partial derivative (one line)
\newcommand{\spder}[2]{\frac{\partial^2 #1}{\partial #2^2}} % Second partial derivative
\newcommand{\mpder}[3]{\frac{\partial^2 #1}{\partial #2 \partial #3}} % Mixed second partial derivative

% Probability
\newcommand{\given}{\where}                            % Conditional expectation
\newcommand{\ind}{\bm{1}}                              % Indicator function
\newcommand{\m}{\mathbf{m}}                            % Lebesgue measure
\renewcommand{\P}{\mathbb{P}}                          % Probability measure
\newcommand{\F}{\mathcal{F}}                           % Filtration
\renewcommand{\wp}{\text{ w.p. }}                      % With probability
\DeclareMathOperator*{\iid}{iid}                       % Independent and identically distributed
\newcommand{\iidsim}{\stackrel{\iid}{\sim}}            % iid over ~
\newcommand{\E}{\mathbb{E}}                            % Expectation
\DeclareMathOperator*{\Var}{Var}                       % Variance
\DeclareMathOperator*{\Cov}{Cov}                       % Covariance
\DeclareMathOperator*{\Avar}{Avar}                     % Asymptotic variance
\DeclareMathOperator*{\Acov}{Acov}                     % Asymptotic covariance
\newcommand{\eqd}{\,{\buildrel \mathcal{D} \over =}\,} % Equal in distribution
\newcommand{\dto}{\,{\buildrel d \over \to}\,}         % Converges in distribution
\newcommand{\pto}{\,{\buildrel p \over \to}\,}         % Converges in probability
\newcommand{\io}{\text{ i.o.}}                         % Infinitely often
\DeclareMathOperator*{\plim}{plim}                     % Probability limit


%%% 3. Syntax Highlighting

% Colors
\hypersetup{colorlinks=true,
  linkcolor=blue, % internal links (sections, equations, etc.)
  urlcolor=blue,  % URL links
  citecolor=blue, % citations
}
\definecolor{codegreen}{RGB}{28,172,0}
\definecolor{codepurple}{RGB}{170,55,241}
\definecolor{lightgray}{gray}{.95}

% Bash syntax highlighting
\lstdefinestyle{bash}{%
  language=bash,%
  basicstyle=\footnotesize\ttfamily,%
  showstringspaces=false,%
  commentstyle=\color{gray},%
  keywordstyle=\color{blue},%
  xleftmargin=0.0in,%
  xrightmargin=0.0in,%
  backgroundcolor=\color{lightgray},
  escapeinside={\%*}{*)}% if you want to add LaTeX within your code
}

% MATLAB syntax highlighting
\lstdefinestyle{matlab}{%
  language=Matlab,%
  basicstyle=\footnotesize\ttfamily,%
  breaklines=true,%
  morekeywords={matlab2tikz},%
  keywordstyle=\color{blue},%
  morekeywords=[2]{1},%
  keywordstyle=[2]{\color{black}},%
  identifierstyle=\color{black},%
  stringstyle=\color{codepurple},%
  commentstyle=\color{codegreen},%
  showstringspaces=false,%
  emph=[1]{for,end,break,switch,case},%
  emphstyle=[1]\color{blue},%
  upquote=true,%
  backgroundcolor=\color{lightgray}
}

% Highlight the 'julia>' prompt.
% See http://tex.stackexchange.com/a/172076/50294 for the additional highlighting
% See http://tex.stackexchange.com/a/180619/50294 for the '>' issue
\makeatletter
\lst@InstallKeywords k{attributes}{attributestyle}\slshape{attributestyle}{}ld
\makeatother

% Julia definition (c) 2014 Jubobs
\lstdefinelanguage{Julia}%
  {morekeywords={abstract,break,case,catch,const,continue,do,else,elseif,%
      end,export,false,for,function,immutable,import,importall,if,in,%
      macro,module,otherwise,quote,return,switch,true,try,type,typealias,%
      using,while},%
   sensitive=true,%
   alsoother={\$},%
   morecomment=[l]\#,%
   morecomment=[n]{\#=}{=\#},%
   morestring=[s]{"}{"},%
   morestring=[m]{'}{'},%
}[keywords,comments,strings]%

% Julia syntax highlighting
\lstdefinestyle{julia}{%
  language=Julia,%
  basicstyle=\footnotesize\ttfamily,%
  breaklines=true,%
  keywordstyle=\bfseries\color{blue},%
  identifierstyle=\color{black},%
  stringstyle=\color{codegreen},%
  commentstyle=\color{codepurple},%
  showstringspaces=false,%
  upquote=true,%
  backgroundcolor=\color{lightgray},%
  alsoletter={>},%
  moreattributes={julia>},%
  attributestyle = \bfseries\color{green},%
  escapeinside={\%*}{*)},% if you want to add LaTeX within your code
}

% Inline code snippets
% http://tex.stackexchange.com/a/42964
% http://tex.stackexchange.com/a/83883/50294
\newcommand{\hltext}[1]{{\fontfamily{pcr}\selectfont\colorbox{lgray}{#1}}}
\newcommand{\bashinline}[1]{\colorbox{lightgray}{{\lstset{style=bash}\lstinline!#1!}}}
\newcommand{\matlabinline}[1]{\colorbox{lightgray}{{\lstset{style=matlab}\lstinline!#1!}}}
\newcommand{\juliainline}[1]{\colorbox{lightgray}{{\lstset{style=julia}\lstinline!#1!}}}

% To-dos
\newcommand{\todo}[1]{\textcolor{red}{[TODO: #1]}}


%%% 4. Cross-References

% Customize reference formats
% https://tex.stackexchange.com/a/122178/116532 (general)
% https://tex.stackexchange.com/a/359651/116532 (subequation)
% https://tex.stackexchange.com/a/10116/116532 (footnote)
\crefformat{equation}{equation (#2#1#3)}
\crefrangeformat{equation}{equations (#3#1#4) to~(#5#2#6)}
\crefmultiformat{equation}{equations (#2#1#3)}{ and~(#2#1#3)}{, (#2#1#3)}{ and~(#2#1#3)}
\crefalias{subequation}{equation}
\crefformat{footnote}{#2\footnotemark[#1]#3}

% Add references section to table of contents
\newcommand{\addrefstoc}{\phantomsection\addcontentsline{toc}{section}{References}}


%%% 5. Other

% Break URLs at hyphens
% https://tex.stackexchange.com/a/254734/116532
\makeatletter
\g@addto@macro{\UrlBreaks}{\do\/\do\-}
\makeatother
