%%% 1. Packages

\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{bm}               % Bold math
\usepackage{booktabs}         % Nice tables
\usepackage{cancel}           % Cancel out math terms
\usepackage{color}            % Color
\usepackage{float}            % Force figure placement with H option
\usepackage[bottom]{footmisc} % Footnote at page bottom
\usepackage{graphicx}         % Graphics support
\usepackage{listings}         % Syntax-highlighted code
\usepackage{mathrsfs}         % Script math
\usepackage{mathtools}        % Fix spacing around over-/underbraces with \mathclap
\usepackage{natbib}           % Bibliography support
\usepackage{subcaption}       % Subfigures and subtables
\usepackage{hyperref}         % Link support, should be loaded last if possible (https://tex.stackexchange.com/q/1863/116532)
\usepackage{cleveref}         % Better cross-references, must be loaded after hyperref


%%% 2. Math Typesetting

% Label individual equations in align* or gather*
% Example (only first equation is labeled):
%   \begin{align*}
%     f(x) &= ax^2 + bx + c \tageq \label{eq:f} \\
%     g(x) &= \log x \\
%     h(x) &= f(x) + g(x)
%   \end{align*}
%   As we see in equation~\eqref{eq:f}...
\newcommand*{\tageq}{\refstepcounter{equation}\tag{\theequation}}

% Switch \epsilon and \varepsilon
\let\oldepsilon\epsilon
\let\oldvarepsilon\varepsilon
\renewcommand{\epsilon}{\oldvarepsilon}
\renewcommand{\varepsilon}{\oldepsilon}

% Add space before \forall
\let\oldforall\forall
\renewcommand{\forall}{\ \oldforall}

% Wide versions of accents
\renewcommand{\bar}[1]{\overline{#1}}
\renewcommand{\hat}[1]{\widehat{#1}}
\renewcommand{\tilde}[1]{\widetilde{#1}}

% Paired delimiters
\newcommand{\group}[1]{\left. #1 \right.}
\newcommand{\paren}[1]{\left( #1 \right)}
\newcommand{\bracket}[1]{\left[ #1 \right]}
\newcommand{\curly}[1]{\left\{ #1 \right\}}
\newcommand{\inner}[1]{\left\langle #1 \right\rangle}  % Inner product
\newcommand{\floor}[1]{\left\lfloor #1 \right\rfloor}  % Floor
\newcommand{\ceil}[1]{\left\lceil #1 \right\rceil}     % Ceiling
\newcommand{\abs}[1]{\left| #1 \right|}                % Absolute value
\newcommand{\norm}[1]{\left\lVert #1 \right\rVert}     % Norm
\newcommand{\eval}[1]{\left. #1 \right|}               % Evaluated at

% Overbrace and underbrace text
% Usage:
%   \undertexti{x}{one line}
%   \undertextii{x}{two lines}{stacked}
%   \undertextiii{x}{three}{lines}{stacked}
\newcommand{\overtexti}[2]{\overbrace{#1}^{\mathclap{\text{#2}}}}
\newcommand{\overtextii}[3]{\overbrace{#1}^{\mathclap{\substack{\text{#2} \\ \text{#3}}}}}
\newcommand{\overtextiii}[4]{\overbrace{#1}^{\mathclap{\substack{\text{#2} \\ \text{#3} \\ \text{#4}}}}}
\newcommand{\undertexti}[2]{\underbrace{#1}_{\mathclap{\text{#2}}}}
\newcommand{\undertextii}[3]{\underbrace{#1}_{\mathclap{\substack{\text{#2} \\ \text{#3}}}}}
\newcommand{\undertextiii}[4]{\underbrace{#1}_{\mathclap{\substack{\text{#2} \\ \text{#3} \\ \text{#4}}}}}

% General math
\newcommand{\oh}{\frac{1}{2}}                          % 1/2
\newcommand{\suchthat}{\text{ s.t. }}                  % Such that
\newcommand{\where}{\middle|}                          % Where
\newcommand{\comp}[1]{#1^{\mathsf{c}}}                 % Complement
\newcommand{\inv}[1]{#1^{-1}}                          % Inverse
\renewcommand{\d}{\ \text{d}}                          % Differential
\newcommand{\corrto}{\rightrightarrows}                % Correspondence
\newcommand{\N}{\mathbb{N}}                            % Natural numbers
\newcommand{\Z}{\mathbb{Z}}                            % Integers
\newcommand{\Q}{\mathbb{Q}}                            % Rational numbers
\newcommand{\R}{\mathbb{R}}                            % Real numbers
\newcommand{\C}{\mathbb{C}}                            % Complex numbers
\renewcommand{\L}{\mathcal{L}}                         % Lagrangian for optimization problem
\newcommand{\sumin}{\sum_{i=1}^n}                      % Sum from 1 to n
\newcommand{\prodin}{\prod_{i=1}^n}                    % Product from 1 to n
\newcommand{\join}{\vee}                               % Join
\newcommand{\bigjoin}{\bigvee}                         %
\newcommand{\meet}{\wedge}                             % Meet
\newcommand{\bigmeet}{\bigwedge}                       %
\DeclareMathOperator*{\argmax}{arg\,max}               % Argmax
\DeclareMathOperator*{\argmin}{arg\,min}               % Argmin
\newcommand{\bmat}[1]{\begin{bmatrix} #1 \end{bmatrix}} % Bracket matrix

% Derivatives
\newcommand{\der}[2]{\frac{\d #1}{\d #2}}              % Derivative
\newcommand{\derol}[2]{\d #1/\d #2}                    % Derivative (one line)
\newcommand{\sder}[2]{\frac{\d^2 #1}{\d #2^2}}         % Second derivative
\newcommand{\pder}[2]{\frac{\partial #1}{\partial #2}} % Partial derivative
\newcommand{\pderol}[2]{\partial #1/\partial #2}       % Partial derivative (one line)
\newcommand{\spder}[2]{\frac{\partial^2 #1}{\partial #2^2}} % Second partial derivative
\newcommand{\mpder}[3]{\frac{\partial^2 #1}{\partial #2 \partial #3}} % Mixed second partial derivative
\newcommand{\npder}[3]{\frac{\partial^{#1} #2}{\partial #3^{#1}}} % nth partial derivative
\newcommand{\nmpder}[4]{\frac{\partial^{#1} #2}{\partial #3 \cdots \partial #4}} % nth mixed partial derivative

% Probability
\newcommand{\given}{\where}                            % Conditional expectation
\newcommand{\ind}{\bm{1}}                              % Indicator function
\newcommand{\m}{\mathbf{m}}                            % Lebesgue measure
\renewcommand{\P}{\mathbb{P}}                          % Probability measure
\newcommand{\F}{\mathcal{F}}                           % Filtration
\DeclareMathOperator{\supp}{supp}                      % Support
\renewcommand{\wp}{\text{ w.p. }}                      % With probability
\DeclareMathOperator*{\iid}{iid}                       % Independent and identically distributed
\newcommand{\iidsim}{\stackrel{\iid}{\sim}}            % iid over ~
\newcommand{\E}{\mathbb{E}}                            % Expectation
\DeclareMathOperator*{\Var}{Var}                       % Variance
\DeclareMathOperator*{\Cov}{Cov}                       % Covariance
\DeclareMathOperator*{\Avar}{Avar}                     % Asymptotic variance
\DeclareMathOperator*{\Acov}{Acov}                     % Asymptotic covariance
\newcommand{\eqd}{\,{\buildrel \mathcal{D} \over =}\,} % Equal in distribution
\newcommand{\dto}{\,{\buildrel d \over \to}\,}         % Converges in distribution
\newcommand{\pto}{\,{\buildrel p \over \to}\,}         % Converges in probability
\newcommand{\io}{\text{ i.o.}}                         % Infinitely often
\DeclareMathOperator*{\plim}{plim}                     % Probability limit


%%% 3. Cross-References

% Customize reference formats
% https://tex.stackexchange.com/a/122178/116532 (general)
% https://tex.stackexchange.com/a/359651/116532 (subequation)
% https://tex.stackexchange.com/a/10116/116532 (footnote)
\crefformat{equation}{equation (#2#1#3)}
\crefrangeformat{equation}{equations (#3#1#4) to~(#5#2#6)}
\crefmultiformat{equation}{equations (#2#1#3)}{ and~(#2#1#3)}{, (#2#1#3)}{ and~(#2#1#3)}
\crefalias{subequation}{equation}
\crefformat{footnote}{#2\footnotemark[#1]#3}

\Crefname{assump}{Assumption}{Assumptions}
\Crefname{claim}{Claim}{Claims}
\Crefname{conj}{Conjecture}{Conjectures}
\Crefname{corollary}{Corollary}{Corollaries}
\Crefname{defn}{Definition}{Definitions}
\Crefname{example}{Example}{Examples}
\Crefname{lemma}{Lemma}{Lemmata}
\Crefname{prop}{Proposition}{Propositions}
\Crefname{remark}{Remark}{Remarks}
\Crefname{theorem}{Theorem}{Theorems}

% Add references section to table of contents
\newcommand{\addrefstoc}{\phantomsection\addcontentsline{toc}{section}{References}}


%%% 4. Other

% Format listings (code snippets)
\lstset{basicstyle=\normalsize\ttfamily,breaklines=true}

% Break URLs at hyphens
% https://tex.stackexchange.com/a/254734/116532
\makeatletter
\g@addto@macro{\UrlBreaks}{\do\/\do\-}
\makeatother

% Redefine theorems
% https://tex.stackexchange.com/a/296184/116532
\makeatletter
\def\renewtheorem#1{%
  \expandafter\let\csname#1\endcsname\relax
  \expandafter\let\csname c@#1\endcsname\relax
  \gdef\renewtheorem@envname{#1}
  \renewtheorem@secpar
}
\def\renewtheorem@secpar{\@ifnextchar[{\renewtheorem@numberedlike}{\renewtheorem@nonumberedlike}}
\def\renewtheorem@numberedlike[#1]#2{\newtheorem{\renewtheorem@envname}[#1]{#2}}
\def\renewtheorem@nonumberedlike#1{
  \def\renewtheorem@caption{#1}
  \edef\renewtheorem@nowithin{\noexpand\newtheorem{\renewtheorem@envname}{\renewtheorem@caption}}
  \renewtheorem@thirdpar
}
\def\renewtheorem@thirdpar{\@ifnextchar[{\renewtheorem@within}{\renewtheorem@nowithin}}
\def\renewtheorem@within[#1]{\renewtheorem@nowithin[#1]}
\makeatother
